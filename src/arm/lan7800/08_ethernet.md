# 第8章 10/100/1000 Ethernet MAC

イーサネットメディアアクセスコントローラ (MAC) は、イーサネット/ IEEE 802.3
準拠のノードを操作するために必要な基本的なプロトコルを内蔵し、イーサネットPHYへの
インターフェイスを提供します。MACは全二重1000Mbpsまたは半二重/全二重10/100Mbps
モードで動作させることができます。

半二重モードで動作する場合、MACはISO/IEC 8802-3 (ANSI/IEEE規格) のセクション4
およびANSI/IEEE 802.3規格に完全に準拠しています。全二重モードで動作する場合、
MACはIEEE 802.3x全二重操作規格に準拠します。

MACは、ホスト監視、バス使用率、メッセージの前後処理を最小化するように設計された
プログロム可能な拡張機能を提供します。これらの機能には、衝突後の再試行を無効に
する機能、フレーム単位での動的FCS（Frame Check Sequence）生成機能、最小フレーム
サイズ属性を強制する自動パッドフィールド挿入・削除機能、衝突フレームの自動再送信
・検出機能が含まれます。

MAC機能の主要な属性は以下の通りです。

- イーサネットPHYとのインタフェース
- 送受信メッセージデータのカプセル化
- フレーミング（フレーム境界の区切り，フレーム同期）
- エラー検出（物理媒体伝送エラー）
- FCSのチェック／除去／生成
- プリアンブルの除去／生成
- メディアアクセス管理
- メディア割り当て（衝突検知，全二重操作を除く）
- 競合解消（衝突処理，全二重操作を除く）
- 全二重モードにおけるフロー制御
- コントロールフレームのデコード（PAUSEコマンド）と送信器の無効化
- コントロールフレームの生成（PAUSEコマンド）
- 最小パケット間ギャップ（IPG）の維持
- マジックパケット/WOL (Wake-On-LAN) の検出
- リモートウェイクアップフレームの検出
- Neighbor Solicitationオフロード
- ARPオフロード
- Simple Network Management Protocol (SNMP) と Remote Monitoring (RMON) 管理カウンターセットの実装

送受信のデータパスは、デバイス内でMACとUSBインターフェースで分離されており、特に
全二重モードでは最高のパフォーマンスを実現します。

バックエンドにおいて、MACは内部GMIIポートとMIIポートを介してPHYとインターフェースします。
GMIIポートは1000Mbps動作に、MIIポートは10/100Mbps動作に使用されます。デバイスの
レジスタも内部SMI (Serial Management Interface) バスを介してPHYのレジスタにアクセス
するメカニズムも提供します。

FCT RXとTX FIFO、URX FIFOとUTX FIFOは、MACへのパケットバッファストレージの増加を
可能にします。FIFOは、USBインターフェースとMACをつなぐパイプであり、すべての送受信
データと様々なコマンド/ステータス情報がやり取りされます。Deep FIFOは様々なトランス
ポートやOSソフトウェアスタックに対して高度なレイテンシ許容度を実現し、オーバーラン
状態を低減・最小化します。
